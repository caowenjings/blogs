(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{201:function(t,s,a){t.exports=a.p+"assets/img/explorer.10d95363.png"},202:function(t,s,a){t.exports=a.p+"assets/img/pwa1.824745b0.png"},203:function(t,s,a){t.exports=a.p+"assets/img/pwa2.d9643987.png"},204:function(t,s,a){t.exports=a.p+"assets/img/pwa3.1317923b.png"},205:function(t,s,a){t.exports=a.p+"assets/img/pwa4.b433f47a.png"},251:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"浏览器进程和线程、pwa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器进程和线程、pwa"}},[t._v("#")]),t._v(" 浏览器进程和线程、PWA")]),t._v(" "),s("h2",{attrs:{id:"_1、浏览器进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、浏览器进程"}},[t._v("#")]),t._v(" 1、浏览器进程")]),t._v(" "),s("ol",[s("li",[t._v("GPU 进程：浏览器全局只有这么一个进程，主要与图形渲染有关。")]),t._v(" "),s("li",[t._v("其他插件的进程，浏览器安装插件，一个插件就是一个进程。")]),t._v(" "),s("li",[t._v("browser 进程：浏览器的主进程（负责协调、主控），只有一个。主要功能如下：")])]),t._v(" "),s("ul",[s("li",[t._v("负责浏览器界面显示，与用户交互，如前进、后退等。")]),t._v(" "),s("li",[t._v("负责各个页面的管理，创建和销毁其他进程")])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("浏览器渲染进程，也被称为浏览器内核。负责页面的渲染，脚本执行，时间处理，网络请求等功能。分类有：")])]),t._v(" "),s("ul",[s("li",[t._v("Google Chrome：Chrome 28 开发版本中还在使用 WebKit，最新的 Chrome 使用 Blink。")]),t._v(" "),s("li",[t._v("Internet Explorer：Trident 内核，ie 内核")]),t._v(" "),s("li",[t._v("Mozilla Firefox：Gecko 内核，firefox 内核")]),t._v(" "),s("li",[t._v("safari：Webkit")]),t._v(" "),s("li",[t._v("Opera：最初是 Presto 内核，后来是 Webkit，现在是 Blink 内核\n"),s("img",{attrs:{src:a(201),alt:""}})])]),t._v(" "),s("h2",{attrs:{id:"_2、浏览器的渲染进程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、浏览器的渲染进程"}},[t._v("#")]),t._v(" 2、浏览器的渲染进程")]),t._v(" "),s("p",[t._v("在一个进程中，至少有一个线程，线程为 CPU 任务调度的最小执行单位。浏览器的渲染进程中有如下线程：")]),t._v(" "),s("ol",[s("li",[t._v("GUI 渲染线程：解析 html 文档，生成 DOM 树与 CSS 树（注意 CSS 树不会阻塞 dom 树的生成）。当生成 DOM 树和 CSS 树之后，就根据这两个树生成一个 render 树（在生成 render 树时候，如果有一方没有解析完毕就会等待解析完成，此时双方会相互阻塞），然后将这个 render 树渲染到界面上。当页面触发回流或者重绘的时候，会再次执行此次操作。")]),t._v(" "),s("li",[t._v("js 线程：执行 js 代码。与 GUI 线程互斥，当一个执行时，另一个会被强制挂起。当 js 执行一个时间负责度高的算法时，导致 GUI 渲染线程被挂起太久，会导致页面卡顿，解决办法可以通过 web worker 解决。")]),t._v(" "),s("li",[t._v("定时器线程：用来处理定时器线程，当定时器到期的时候，将回调放在任务队列里面，等待 js 线程的执行。js 是单线程的，为了避免代码执行冲突，添加定时器线程，用于处理定时器操作。")]),t._v(" "),s("li",[t._v("事件触发线程：用来管理事件的触发，例如：点击事件、鼠标移动事件。当这些事件被触发时，将事件的回调添加至任务队列，等待 js 的执行。")]),t._v(" "),s("li",[t._v("异步 HTTP 请求线程：在 XMLHttpRequest 连接后新启动一个线程，线程如果检测到请求的状态变更，如果设置有回调函数，该线程会把回调函数添加至事件队列，等待 js 执行。")])]),t._v(" "),s("h3",{attrs:{id:"_1、渲染流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、渲染流程"}},[t._v("#")]),t._v(" 1、渲染流程")]),t._v(" "),s("p",[t._v("构建 DOM 树 -> CSS Parser -> 样式计算 -> 布局阶段 -> 分层 ->绘制 -> 分块 -> 光栅化和合成，渲染是在渲染进程执⾏的，渲染进程分为渲染主线程、光栅线程、合成线程等；从分块阶段开始，分块、光栅化、合成这三步是在⾮渲染主线程执⾏。")]),t._v(" "),s("p",[t._v("⼀个完整的渲染流程⼤致可总结为如下：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("构建 DOM 树: 渲染进程通过 HTML Parser 将 HTML 字符串转换为浏览器能够读懂的 DOM 树结构，查看：document")])]),t._v(" "),s("li",[s("p",[t._v("构建 Style Rules: 渲染引擎将 CSS 字符串转化为浏览器可以理解的 styleSheets，查看：document.styleSheets")])]),t._v(" "),s("li",[s("p",[t._v("样式计算：根据上⾯两步⽣成的 DOM Tree 和 Style Rules，可以计算出 DOM 节点的样式。")])]),t._v(" "),s("li",[s("p",[t._v("创建布局树：计算出 DOM 节点的样式后，还需要知道 DOM 节点在⻚⾯中显示的位置，这就需要计算元素的布局信息，⽣成⼀颗布局树，其中不包括不显示的 DOM 节点。")])]),t._v(" "),s("li",[s("p",[t._v("分层：对布局树进⾏分层，并⽣成分层树，具体哪些元素需要分层是由 CSS 决定的，⽐如 z-index 等，也可以设置 will-change 来通知浏览器此元素需要分层。")])]),t._v(" "),s("li",[s("p",[t._v("绘制：为每个图层⽣成绘制列表，并将其提交到合成线程。")])]),t._v(" "),s("li",[s("p",[t._v("分块、光栅化: 合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。")])]),t._v(" "),s("li",[s("p",[t._v("合成：把光栅化⽣成的多张位图合成⼀张位图；合成线程发送绘制图块命令 DrawQuad 给浏览器进程。")])]),t._v(" "),s("li",[s("p",[t._v("显示：浏览器进程根据 DrawQuad 消息⽣成⻚⾯，并显示到显示器上")])])]),t._v(" "),s("h3",{attrs:{id:"_2、相关问题解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、相关问题解析"}},[t._v("#")]),t._v(" 2、相关问题解析")]),t._v(" "),s("ol",[s("li",[t._v("HTML Parser 需要等待 HTML 全部加载完再解析？还是边加载边解析？")])]),t._v(" "),s("p",[t._v("一边加载一边解析，转换为：document")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("JS 如何影响 HTML Parser？\nscript 脚本放在 body 元素中页面内容的后面，避免 js 阻碍 html 解析，减少白屏时间，")])]),t._v(" "),s("ul",[s("li",[t._v("内嵌的 js 脚本会执行阻塞 html 解析、网络加载的 js 脚本也会阻塞 html 解析")]),t._v(" "),s("li",[t._v("script 标签中的 defer 属性，延迟执行脚本，解析完"),t._v("后执行，执行顺序不变，即第一个 defer 脚本会在第二个 defer 脚本前执行")]),t._v(" "),s("li",[t._v("script 标签中的 async 属性，异步执行脚本，文件加载完成后执行，无法保证执行顺序，哪个加载完哪个执行。")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("css 如何影响 js 执行？")])]),t._v(" "),s("p",[t._v("由于 JS 可以获取和操作样式，因此会等待 JS 语句之前的 CSS Parser 完成后才会执⾏此 JS ⽂件。 结论： CSS Parser -> JS 执⾏ -> HTML Parser。")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("css 的渲染？")])]),t._v(" "),s("p",[t._v("计算样式的过程不会等待⻚⾯的底部的 Style rules ⽣成完毕， 会先 paint ⼀次⻚⾯，等⻚⾯底部的 CSS 解析完成后，repaint ⼀次，会看到闪烁的情况；因此 CSS ⽂件尽量放在 head 中，尽快下载 CSS ⽂件并解析，然后结合 dom 渲染到⻚⾯中")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("性能优化方法：下载 CSS ⽂件并解析、下载 JS ⽂件并执⾏可能会影响到⻚⾯的⾸屏渲染。因此⼀般可采⽤如下策略：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("css 文件加载尽量放在 head 中，减少 CSS ⽂件体积，对于⼤的 CSS ⽂件，可以通过媒体查询的⽅式加载不同⽤途的 CSS ⽂件， 参考")])]),t._v(" "),s("li",[s("p",[t._v("动画采⽤ css3 动画，或者添加 will-change 属性")])]),t._v(" "),s("li",[s("p",[t._v("script 标签放在⻚⾯内容后，或者不需要在 HTML Parser 阶段使⽤的，可以加上 defer 或者 async")])]),t._v(" "),s("li",[s("p",[t._v("⽹络层⾯：DNS prefetch； 采⽤ CDN；开启 HTTP2 等")])])]),t._v(" "),s("h2",{attrs:{id:"_3、pwa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、pwa"}},[t._v("#")]),t._v(" 3、PWA")]),t._v(" "),s("p",[t._v("PWA（Progressive Web App）渐进式 web app，使用多种技术来增强 web app 的功能，可以让网站的体验变得更好，能够模拟一些原生功能，比如通知推送。在移动端利用标准化框架，让网页应用呈现和原生应用相似的体验。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(202),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_1、解决-web-的三大问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、解决-web-的三大问题"}},[t._v("#")]),t._v(" 1、解决 web 的三大问题")]),t._v(" "),s("ul",[s("li",[t._v("没有一级入口：只能通过浏览器输入 url 访问")]),t._v(" "),s("li",[t._v("不能离线访问：无离线缓冲机制")]),t._v(" "),s("li",[t._v("没有消息推送功能")])]),t._v(" "),s("h3",{attrs:{id:"_2、manifest-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、manifest-json"}},[t._v("#")]),t._v(" 2、manifest.json")]),t._v(" "),s("p",[t._v("一级入口问题：通过引入 manifest.json 解决，主页通过 link 标签引入即可")]),t._v(" "),s("p",[s("img",{attrs:{src:a(203),alt:""}})]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pwa-manifest.html")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("link rel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"manifest"')]),t._v(" href"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/manifest.json"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//manifest.json")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//web app名称")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PWA Demo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"short_name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PWA"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//显示模式：fullscreen全屏模式、standalone独⽴应⽤模式")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//minimal-ui比standalone多出地址栏、browser浏览器模式")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"display"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"standalone"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//应用描述")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pwa demo description"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指定了⽤户打开该Web App时加载的URL")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"start_url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/pwa-manifest.html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指定桌面图标")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"icons"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//图标路径，相对于manifest.json")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"src"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/icon/logo-144.png"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"sizes"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"144x144"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//图标大小")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"image/png"')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//图标类型")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开屏界面默认背景")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"background_color"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#aaa"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//应用程序默认背景色")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"theme_color"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#aaa"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3、service-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、service-worker"}},[t._v("#")]),t._v(" 3、service worker")]),t._v(" "),s("p",[t._v("解决离线访问问题，本质为浏览器和后端服务的代理中间件，兼容性不佳，百度使用 local storage 模拟功能\n"),s("img",{attrs:{src:a(204),alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("特点：\n"),s("ul",[s("li",[t._v("不能访问／操作 dom")]),t._v(" "),s("li",[t._v("会⾃动休眠，不会随浏览器关闭所失效(必须⼿动卸载)")]),t._v(" "),s("li",[t._v("离线缓存内容开发者可控")]),t._v(" "),s("li",[t._v("必须在 https 或者 localhost 下使⽤")]),t._v(" "),s("li",[t._v("所有的 api 都基于 promise")])])]),t._v(" "),s("li",[t._v("原理：浏览器和后端服务之间的中间件")]),t._v(" "),s("li",[t._v("生命周期\n"),s("ul",[s("li",[t._v("installing：sw 注册之后，表示开始安装，会触发 install 事件")]),t._v(" "),s("li",[t._v("installed")]),t._v(" "),s("li",[t._v("activating：触发 activate 事件")]),t._v(" "),s("li",[t._v("activated")]),t._v(" "),s("li",[t._v("redundant：冗余卸载时触发")])])]),t._v(" "),s("li",[t._v("事件\n"),s("ul",[s("li",[t._v("install\n"),s("ul",[s("li",[t._v("installing 生命周期函数中触发")]),t._v(" "),s("li",[t._v("event.waitUntil(promise)，等待 promise resolved 后进入下一个生命周期 installed")]),t._v(" "),s("li",[t._v("self.skipWaiting 可跳过 installed 生命周期，直接进入 activating 生命周期")])])]),t._v(" "),s("li",[t._v("activate\n"),s("ul",[s("li",[t._v("activating 生命周期内被触发")]),t._v(" "),s("li",[t._v("event.waitUntil(promise)，等待 promise resolved 后进入下一个生命周期 activated")]),t._v(" "),s("li",[t._v("self.clients.claim()，执行该方法表示取得页面控制权，这样打开页面就会使用新版本的缓存")])])]),t._v(" "),s("li",[t._v("fetch：监听数据获取 fetch 方法")]),t._v(" "),s("li",[t._v("push：监听推送消息")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ***** pwa-demo.html *****")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DOCTYPE")]),t._v(" html"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("html lang"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"en"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta charset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF-8"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("equiv"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-UA-Compatible"')]),t._v(" content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IE=edge"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"viewport"')]),t._v(" content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"width=device-width, initial-scale=1.0"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("pwa manifest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 引入manifest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json文件 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("link rel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"manifest"')]),t._v(" href"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/manifest.json"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("pwa manifest "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.01")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./sw-cache.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//***** sw-cache.js *****")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//serviceworker挂载在navigator下")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./sw.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'service worker 注册成功'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//缓存有更新，重新加载页面")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" refreshing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'controllerchange'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("refreshing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    refreshing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//***** sw.js *****")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//pwa全局对象专属对象 self、caches")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cacheName "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.01'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存的key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cacheFiles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./pwa-manifest.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./sw-cache.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./manifest.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./icon/logo-144-144.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听install事件")]),t._v("\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'install'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Service Worker 状态： install'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("skipWaiting")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheOpenPromise "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheFiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("waitUntil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheOpenPromise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等待promise resolved后，会进入下一个生命周期 installed")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听fetch事件，返回fetch数据缓存")]),t._v("\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fetch'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果有cache则直接返回，否则通过fetch请求")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("respondWith")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听activate事件，激活后通过cache的key来判断是否更新cache中的静态资源")]),t._v("\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'activate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Service Worker 状态： activate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cachePromise "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" cacheName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("waitUntil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cachePromise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clients"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("claim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 激活当前client")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4、push"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、push"}},[t._v("#")]),t._v(" 4、Push")]),t._v(" "),s("p",[t._v("解决通知问题：网站内通知，当前网站收到本网站的消息\n"),s("img",{attrs:{src:a(205),alt:""}}),t._v("\n浏览器和应用服务器间，添加 Push Service 中间代理层，用于消息订阅和推送，核⼼实现流程：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Subscribe: 向 Push Service 发起订阅，获取 PushSubscription")])]),t._v(" "),s("li",[s("p",[t._v("Monitor: 实现浏览器和 PushService 通信 （⽤户离线，PushSevice 会维护消息列表）")])]),t._v(" "),s("li",[s("p",[t._v("Distribute Push Resource: 将 PushSubscription 交给服务器，⽤于通信")])]),t._v(" "),s("li",[s("p",[t._v("Push Message: 服务端将消息推送给 Push Service， Push Service 推送给对应的客户端\n兼容性： Chrome 所依赖的 FCM 服务在国内是⽆法访问的，⽽ Firefox 的服务在国内可以正常使⽤。")])])]),t._v(" "),s("h3",{attrs:{id:"_5、notification"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、notification"}},[t._v("#")]),t._v(" 5、Notification")]),t._v(" "),s("p",[t._v("解决消息通知问题：网站外通知，百度收到淘宝发送的通知")]),t._v(" "),s("h2",{attrs:{id:"_4、web-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、web-worker"}},[t._v("#")]),t._v(" 4、web Worker")]),t._v(" "),s("p",[t._v("Web Worker 是 HTML5 标准的一部分，这一规范定义了一套 API，它允许一段 JavaScript 程序运行在主线程之外的另外一个线程中。")]),t._v(" "),s("p",[t._v("参考资料："),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/95021220",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Worker 使用教程（阮一峰）"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_5、web-socket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、web-socket"}},[t._v("#")]),t._v(" 5、web socket")]),t._v(" "),s("p",[t._v("websocked 时一种双向通信协议，在建立连接后，websocked 服务端和浏览器都能主动向对方发送和接收数据，websocked 类似 tcp 的客户端和服务器通过握手连接，连接成功后才可通信。")])])}),[],!1,null,null,null);s.default=e.exports}}]);